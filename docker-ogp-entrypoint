#!/bin/bash
set -e

CONFIG_FILE=/var/www/html/includes/config.inc.php

echo "<?php" > ${CONFIG_FILE}
echo "# THIS IS AUTOGENERATED BY THE ENTRYPOINT" >> ${CONFIG_FILE}
echo "# THIS WILL BE OVERWRITTEN WHNE CONTAINER IS RESTARTED." >> ${CONFIG_FILE}
echo "#######################################################" >> ${CONFIG_FILE}
echo "\$db_host=\"$MYSQL_HOST\";" >> ${CONFIG_FILE}
echo "\$db_user=\"$MYSQL_USER\";" >> ${CONFIG_FILE}
echo "\$db_pass=\"$MYSQL_PASSWORD\";" >> ${CONFIG_FILE}
echo "\$db_name=\"$MYSQL_DATABASE\";" >> ${CONFIG_FILE}
echo "\$table_prefix="ogp_";" >> ${CONFIG_FILE}
echo "\$db_type="mysql";" >> ${CONFIG_FILE}
echo "?>" >> ${CONFIG_FILE}

if [ -f /var/www/html/install.php ]; then
    rm -rf /var/www/html/install.php
fi

# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- apache2-foreground "$@"
fi

exec "$@"
